def build_prompt(seg_text, stats_text, litho_text, eff_text, gas_text):
    return f"""
你是一名资深 TBM（全断面隧道掘进机）施工分析工程师，熟悉 TBM 施工工况分析、围岩行为特征、气体监测规范和掘进安全要求。

请根据下面提供的两类输入：
1）【工况段落数据（掘进/停机）】
2）【统计信息（汇总数据，如总掘进时长、最长停机段等）】
3）【气体统计信息（每种气体的均值、最大值、超标次数、超标时段等）】

生成一份《TBM 综合工况分析报告》。

报告必须严格按照以下八大章节结构输出，内容必须逻辑清晰、数字准确、专业严谨且不能编造超出数据之外的内容。整体不要超过2000字

--------------------------------------------
【报告结构要求】
--------------------------------------------

一、总体运行情况  
- 基于工况数据描述整体掘进/停机特征  
- 给出掘进占比、停机占比、启停频繁程度  
- 指出 TBM 整体运行效率是否良好  

二、掘进工况统计  
- 展示掘进段数量、总掘进时长、平均掘进时长  
- 指出最长掘进段、最短掘进段  
- 分析短掘进段出现的可能原因  
- 指出掘进是否呈现连续段、是否存在碎片化掘进  

三、停机工况统计  
- 展示停机段数量、总停机时长、平均停机时长  
- 指出最长停机段、短停机段数量  
- 分析停机的潜在原因（例如设备检查、刀具维护、地质处理等）  
- 指出异常长停机段，并说明风险  

四、围岩识别与分布  
- 概括识别到的岩性类别（如 0号岩、1号岩、2号岩）  
- 描述各岩性分布的时间段和变化趋势  
- 指出围岩变化是否频繁、是否可能导致掘进参数不稳定  
- 如有必要，说明某些岩性对应的掘进困难或性能表现  

五、围岩推进效率分析  
基于统计给出：  
- 各岩性的平均贯入度  
- 平均推进速度  
- 平均推力  
- 单位能耗（推力 / 贯入度）  
并分析：  
- 哪类岩性推进效率最高  
- 哪类岩性最困难  
- 是否需要优化推进参数（如扭矩、推力、转速）  

六、异常启停特征  
- 给出频繁启停段的时间范围与数量  
- 指出是否出现大量 0 秒掘进或停机（可能是设备冲击启动/数据误差）  
- 分析是否与围岩变化、设备问题或人员操作相关  
- 若存在异常长时间停机，需重点强调工程风险  

七、重点时段说明（包含气体监测分析）  
对数据中出现的重点风险时段进行解释，包括但不限于：

（1）**工况重点时段说明**  
- 长停机时段原因推测  
- 高频启停时段与岩性关系  
- 最大掘进效率时段特征  

（2）**气体安全分析（必须包含以下内容）：**  
- 对关键气体（O₂、CH₄、CO、H₂S、粉尘等）逐项说明  
- 列出每种气体的平均值、最大值、超标次数  
- 若有超标次数 >0，必须：  
  * 列出超标时段（开始时间~结束时间，持续秒数）  
  * 推测可能原因（如通风不足、瓦斯聚集、刀盘区扰动等）  
  * 分析可能造成的安全风险（缺氧、中毒、瓦斯爆炸、粉尘爆炸等）  

（3）**通风与安全风险评估**  
- 指出是否存在缺氧风险  
- 指出是否存在 CH₄（甲烷）相关爆炸风险  
- 指出粉尘超标是否可能导致设备磨损或爆炸风险  
- 对监测数据是否稳定给出分析  

（4）**气体相关建议（不少于 3 条）**  
建议必须可以落地、工程可执行，例如：  
- 加强局部通风、调整通风管布局  
- 上调风机运行频率  
- 增强粉尘治理（喷雾、封闭运输、抽排）  
- 强化甲烷联锁保护装置的报警与切断功能  
- 对可疑传感器进行校验  

八、结论与建议  
- 综合掘进、围岩、气体三方面给出工程总结  
- 明确 TBM 当前主要风险点  
- 针对掘进效率、停机原因、岩性变化、通风安全等提出可执行建议  
- 内容必须基于数据，不得编造  

【工况段落】
{seg_text}

【工况统计】
{stats_text}

【围岩识别结果】
{litho_text}

【推进效率统计】
{eff_text}

【气体分析】
{gas_text}
请生成最终版《TBM 综合工况分析报告》。
"""
